<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Andrea Gabrio">
<meta name="dcterms.date" content="2025-02-09">

<title>Markov Models in Economic Evaluations III – Andrea Gabrio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../img/icon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Andrea Gabrio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../software.html"> 
<span class="menu-text">Software</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../missing_data.html"> 
<span class="menu-text">Missing Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials.html"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../teaching.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#type-of-time-dependency" id="toc-type-of-time-dependency" class="nav-link active" data-scroll-target="#type-of-time-dependency">Type of time-dependency</a></li>
  <li><a href="#a-simple-example" id="toc-a-simple-example" class="nav-link" data-scroll-target="#a-simple-example">A simple example</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Markov Models in Economic Evaluations III</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Quarto</div>
    <div class="quarto-category">R</div>
    <div class="quarto-category">Academia</div>
    <div class="quarto-category">Health Economics</div>
  </div>
  </div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://angabrio.github.io/agabriosite2/">Andrea Gabrio</a> <a href="https://orcid.org/0000-0002-7650-4534" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://www.maastrichtuniversity.nl/research/methodology-and-statistics">
            Maastricht University
            </a>
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 9, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="featured.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Hello dear readers and welcome to a new post. Today, I would like to resume my current series of posts related to decision analytic models in health economics and focus on some extensions of the simple Markov model structure which I introduced in a <a href="../../posts/2024-11-10-my-blog-post/index.html">post</a> a few months ago. I suggest to check out my previous post for a summary introduction and description of what Markov models are and for what they are used.</p>
<p>A simplifying assumption of traditional Markov models is that the <em>transition probabilities</em> regulating the movement between health states remain constant across the model cycles, i.e.&nbsp;over time. In some cases, this simplification of the reality may represent a too strong assumption that, if kept, may lead to misleading cost-effectiveness results. When this occurs, there are different approaches that can be used to overcome this problem and allow at least some transition probabilities to vary over time. Before going into the technical details on how to do this, I would like first to provide a quick description of the different types of time-dependency that can be allowed for transition probabilities and when a specific type might be preferable to use compared to another. For the topics discussed in this post, I took inspiration from <span class="citation" data-cites="caldwell2007decision">Caldwell (<a href="#ref-caldwell2007decision" role="doc-biblioref">2007</a>)</span>, which I strongly suggest to consult if you would like to have a more in-depth look into the matter.</p>
<section id="type-of-time-dependency" class="level2">
<h2 class="anchored" data-anchor-id="type-of-time-dependency">Type of time-dependency</h2>
<p>The first type of time-dependency allows transition probabilities to <em>vary according to the time in the model</em>, so that the probability of a transition between states changes as the cohort ages. For example, when modelling the evolution of a deadly disease, it may be more reasonable to assume that the probability of moving to a death state increases as the cohort ages. To ensure this is possible, the starting age of a cohort should be stated, so that the age of the cohort at any cycle of the model is also known. We can then implement age-dependent transition probabilities by having a unique probability for each cycle. Commonly, these cycle-dependent transition probabilities are taken from the literature under the form of national life-tables, where death probabilities for different age groups for the target population are usually reported. In general, it makes sense for the transition probabilities to increase as the cohort ages. In addition, since all transition probabilities in a given cycle need to sum up to 1, the probability of remaining in a given state for the next cycle has also to allow for an age-dependent probability.</p>
<p>The second type of time-dependency allows transition probabilities to <em>vary according to time in state</em>, so that the probability changes as the time spent in a state increases. For example, when modelling the evolution of a deadly disease, it may be more reasonable to assume that the probability to move to a death state from a specific disease state increases as the time spent by patients in that disease state also increases. This can be modelled by assuming that the probability of moving between a given state A to another in the model varies according on how long the patient had been in the given state A, given that all patients start in the model in state A at a given time and that once they leave it they cannot return in it. This allows to keep track of how long a patient has been in state A and makes the transition probability dependent on time in a state equivalent to making it dependent on the age of the cohort.</p>
<p>When external sources providing information on age-dependent transition probabilities are not available, the relationship between a transition probability and time can be estimated using patient-level data, i.e.&nbsp;in the form of a longitudinal study recording the time to an event for each patient. Estimation can then be performed by means of <em>survival analysis</em> methods, which allow to handle (noninformative) censoring which frequently occurs in longitudinal studies, i.e.&nbsp;when observations stop being recorded before a patient has had the chance of experiencing the event of interest. Usually, <em>parametric survival models</em> are employed in order to obtain an estimate of the relation between the risk of experiencing an event and time, represented by the functional form of the hazard function. In particular, of key importance is the <strong>survivor function</strong></p>
<p><span class="math display">\[
S(t)=P(T&gt;t)=1-F(t),
\]</span></p>
<p>denoting the probability of surviving (i.e.&nbsp;not experiencing the event) for a period of time greater than <span class="math inline">\(t\)</span>, with <span class="math inline">\(F(t)=P(T\leq t)\)</span> being the <strong>cumulative density function</strong>. We can also express the survivor function in terms of the <strong>cumulative hazard function</strong> such that</p>
<p><span class="math display">\[
S(t)=\text{exp}\{-H(t)\},
\]</span></p>
<p>where, $H(t) $denotes the cumulative instantaneous chance of experiencing the event (i.e.&nbsp;hazard rate) at time <span class="math inline">\(t\)</span>, conditional on having survived to time <span class="math inline">\(t\)</span>. Using this relationship, it is possible to derive transition probabilities for Markov models. For example, let’s consider a single type of Markov model with only two states, i.e.&nbsp;alive and death, so that only one transition probability needs to be estimated. Define the length of the Markov cycle as <span class="math inline">\(u\)</span> and let the instantaneous hazard of death at time <span class="math inline">\(t\)</span> be <span class="math inline">\(h(t)\)</span>. We now need to estimate the discrete transition probability between the moments <span class="math inline">\((t-u)\)</span> and <span class="math inline">\(t\)</span>, say <span class="math inline">\(p(t_u)\)</span>, where <span class="math inline">\(t_u\)</span> indicates that <span class="math inline">\(t\)</span> is now measured as integer multiples of the cycle length of the model <span class="math inline">\(u\)</span>.</p>
<p>The baseline transition probability of the event of interest can be defined as</p>
<p><span class="math display">\[
p(t_u)=1-\frac{S(t)}{S(t-u)},
\]</span></p>
<p>which can be re-written in terms of the cumulative hazard as</p>
<p><span class="math display">\[
p(t_u)=1-\frac{\text{exp}\{-H(t)\}}{\text{exp}\{-H(t-u)\}}=1-\text{exp}\{H(t-u)-H(t)\}
\]</span></p>
</section>
<section id="a-simple-example" class="level2">
<h2 class="anchored" data-anchor-id="a-simple-example">A simple example</h2>
<p>As a demonstrative example, let’s consider the transition matrix shown in <a href="#tbl-example" class="quarto-xref">Table&nbsp;1</a>, which displays the assumed transition probabilities for three health states (Well, Sick and Dead) from baseline (rows) to 1 month follow-up (columns), for an hypothetical experimental treatment.</p>
<div class="cell">
<div id="tbl-example" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Example Transition Matrix on Experimental Treatment after 1 Month Post-Randomisation
</figcaption>
<div aria-describedby="tbl-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Well</th>
<th style="text-align: right;">Sick</th>
<th style="text-align: right;">Dead</th>
<th style="text-align: right;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Well</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sick</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.60</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dead</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Let’s also assume that patients were randomised to one of two treatments, namely Experimental vs Control, and they were considered to be in either a Well or Sick state. From <a href="#tbl-example" class="quarto-xref">Table&nbsp;1</a>, we can see that the proportion of patients who started the hypothetical trial at baseline in a Well state and then remained in the same state after treatment was <span class="math inline">\(45\%\)</span>, very few patients (<span class="math inline">\(5\%\)</span>) who started the trial in a Sick state improved into a Well state at follow up, and <span class="math inline">\(60\%\)</span> of patients who were in the Sick state did not change states after starting treatment.</p>
<p>Normally, if we kept the assumption of constant transition probabilities within the model, I would be able to compute what the transition matrix will look like after, say, <span class="math inline">\(1\)</span> month by simply multiplying the initial probabilities (e.g.&nbsp;equal to the first row of <a href="#tbl-example" class="quarto-xref">Table&nbsp;1</a>) by the <span class="math inline">\(3\times3\)</span> transition matrix in <a href="#tbl-example" class="quarto-xref">Table&nbsp;1</a>. In general, one can compute the proportion of patients for the <span class="math inline">\(n+1\)</span>-th step in any of these three health states by simply multiplying the updated transition matrix at step <span class="math inline">\(n\)</span> by the given transition matrix. However, if we relax the assumption of constant transition probabilities over time, we need to create an entirely new transition matrix and specify how its entries changes over time. For this example, to ease exposition, I will focus on the first type of time-dependency where the relation between probabilities and time is expressed in terms of the age of the cohort, i.e.&nbsp;the number of cycles <span class="math inline">\(T\)</span> passed in the model. This can be achieved in <code>R</code> by creating an array of dimensions <span class="math inline">\(3\times3\times T\)</span>, representing the entries of the <span class="math inline">\(3\times3\)</span> transition matrix at each of the <span class="math inline">\(T\)</span> cycles of the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#set model parameters</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>n_t <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>n_s <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>n_c <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>state_names <span class="ot">&lt;-</span> <span class="fu">rownames</span>(tabex)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#create empty transition matrix</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>tm <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>,<span class="at">dim=</span><span class="fu">c</span>(n_s,n_s,n_t), </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">from=</span>state_names,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>                            <span class="at">to =</span> state_names,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>                            <span class="at">cycle =</span> <span class="dv">1</span><span class="sc">:</span>n_t))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#fill in matrix taking into account changes due to cycles </span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>tm[<span class="dv">3</span>,<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co">#no transition from dead to well</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>tm[<span class="dv">3</span>,<span class="dv">2</span>,] <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co">#no transition from dead to sick</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>tm[<span class="dv">3</span>,<span class="dv">3</span>,] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co">#dead is absorbing state</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">#set baseline probabilities</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>tm_base <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">0.45</span>,<span class="fl">0.05</span>,<span class="dv">0</span>,<span class="fl">0.35</span>,<span class="fl">0.6</span>,<span class="dv">0</span>,<span class="fl">0.2</span>,<span class="fl">0.35</span>,<span class="dv">1</span>),<span class="dv">3</span>,<span class="dv">3</span>) </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>tm[,,<span class="dv">1</span>] <span class="ot">&lt;-</span> tm_base</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co">#assume that prob of moving from well to sick is increasing linearly over cycles</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>tm[<span class="dv">1</span>,<span class="dv">2</span>,] <span class="ot">&lt;-</span> tm[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>] <span class="sc">+</span> (tm[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">*</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>n_t))<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">#assume that prob of moving from well to death is increasing linearly over cycles but less </span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>tm[<span class="dv">1</span>,<span class="dv">3</span>,] <span class="ot">&lt;-</span> tm[<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">1</span>] <span class="sc">+</span> (tm[<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">1</span>]<span class="sc">*</span><span class="fu">sqrt</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>n_t)))<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">#assume that prob of moving from sick to death is increasing linearly over cycles but more </span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>tm[<span class="dv">2</span>,<span class="dv">3</span>,] <span class="ot">&lt;-</span> tm[<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>] <span class="sc">+</span> (tm[<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>]<span class="sc">*</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>n_t))<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co">#assume that prob of moving from sick to well is constant</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>tm[<span class="dv">2</span>,<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">rep</span>(tm[<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>],n_t)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co">#fill in all other probabilities</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>tm[<span class="dv">1</span>,<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (tm[<span class="dv">1</span>,<span class="dv">2</span>,]<span class="sc">+</span>tm[<span class="dv">1</span>,<span class="dv">3</span>,])</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>tm[<span class="dv">2</span>,<span class="dv">2</span>,] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (tm[<span class="dv">2</span>,<span class="dv">1</span>,]<span class="sc">+</span>tm[<span class="dv">2</span>,<span class="dv">3</span>,])</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>tm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , cycle = 1

      to
from     Well   Sick   Dead
  Well 0.4445 0.3535 0.2020
  Sick 0.0500 0.5965 0.3535
  Dead 0.0000 0.0000 1.0000

, , cycle = 2

      to
from        Well  Sick      Dead
  Well 0.4401716 0.357 0.2028284
  Sick 0.0500000 0.586 0.3640000
  Dead 0.0000000 0.000 1.0000000

, , cycle = 3

      to
from        Well   Sick      Dead
  Well 0.4360359 0.3605 0.2034641
  Sick 0.0500000 0.5685 0.3815000
  Dead 0.0000000 0.0000 1.0000000

, , cycle = 4

      to
from    Well  Sick  Dead
  Well 0.432 0.364 0.204
  Sick 0.050 0.544 0.406
  Dead 0.000 0.000 1.000

, , cycle = 5

      to
from        Well   Sick      Dead
  Well 0.4280279 0.3675 0.2044721
  Sick 0.0500000 0.5125 0.4375000
  Dead 0.0000000 0.0000 1.0000000

, , cycle = 6

      to
from       Well  Sick     Dead
  Well 0.424101 0.371 0.204899
  Sick 0.050000 0.474 0.476000
  Dead 0.000000 0.000 1.000000

, , cycle = 7

      to
from        Well   Sick      Dead
  Well 0.4202085 0.3745 0.2052915
  Sick 0.0500000 0.4285 0.5215000
  Dead 0.0000000 0.0000 1.0000000

, , cycle = 8

      to
from        Well  Sick      Dead
  Well 0.4163431 0.378 0.2056569
  Sick 0.0500000 0.376 0.5740000
  Dead 0.0000000 0.000 1.0000000

, , cycle = 9

      to
from     Well   Sick   Dead
  Well 0.4125 0.3815 0.2060
  Sick 0.0500 0.3165 0.6335
  Dead 0.0000 0.0000 1.0000

, , cycle = 10

      to
from        Well  Sick      Dead
  Well 0.4086754 0.385 0.2063246
  Sick 0.0500000 0.250 0.7000000
  Dead 0.0000000 0.000 1.0000000

, , cycle = 11

      to
from        Well   Sick      Dead
  Well 0.4048668 0.3885 0.2066332
  Sick 0.0500000 0.1765 0.7735000
  Dead 0.0000000 0.0000 1.0000000

, , cycle = 12

      to
from        Well  Sick      Dead
  Well 0.4010718 0.392 0.2069282
  Sick 0.0500000 0.096 0.8540000
  Dead 0.0000000 0.000 1.0000000</code></pre>
</div>
</div>
<p>To continue our example, let’s now consider a more realistic scenario where the transition matrix and initial probabilities are provided for both an experimental group and a control group form an hypothetical trial assessing the cost-effectiveness of the two treatments. The baseline <span class="math inline">\(3\times3\)</span> transition matrix associated with the two Control group is shown in <a href="#tbl-example2" class="quarto-xref">Table&nbsp;2</a>.</p>
<div class="cell">
<div id="tbl-example2" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-example2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Example Transition Matrices on Control Treatment after 1 Month Post-Randomisation
</figcaption>
<div aria-describedby="tbl-example2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Well</th>
<th style="text-align: right;">Sick</th>
<th style="text-align: right;">Dead</th>
<th style="text-align: right;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Well</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sick</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dead</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Next, we define the full transition matrix over time for the Control group as we did for the Experimental group before.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create empty transition matrix</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>tm_control <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>,<span class="at">dim=</span><span class="fu">c</span>(n_s,n_s,n_t), </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">from=</span>state_names,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">to =</span> state_names,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">cycle =</span> <span class="dv">1</span><span class="sc">:</span>n_t))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#fill in matrix taking into account changes due to cycles </span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>tm_control[<span class="dv">3</span>,<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co">#no transition from dead to well</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>tm_control[<span class="dv">3</span>,<span class="dv">2</span>,] <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co">#no transition from dead to sick</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>tm_control[<span class="dv">3</span>,<span class="dv">3</span>,] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co">#dead is absorbing state</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">#set baseline probabilities</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>tm_base_control <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">0.25</span>,<span class="fl">0.10</span>,<span class="dv">0</span>,<span class="fl">0.25</span>,<span class="fl">0.45</span>,<span class="dv">0</span>,<span class="fl">0.50</span>,<span class="fl">0.45</span>,<span class="dv">1</span>),<span class="dv">3</span>,<span class="dv">3</span>) </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>tm_control[,,<span class="dv">1</span>] <span class="ot">&lt;-</span> tm_base</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">#assume that prob of moving from well to sick is increasing linearly over cycles</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>tm_control[<span class="dv">1</span>,<span class="dv">2</span>,] <span class="ot">&lt;-</span> tm_control[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>] <span class="sc">+</span> (tm_control[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">*</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>n_t))<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">#assume that prob of moving from well to death is increasing linearly over cycles but less </span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>tm_control[<span class="dv">1</span>,<span class="dv">3</span>,] <span class="ot">&lt;-</span> tm_control[<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">1</span>] <span class="sc">+</span> (tm_control[<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">1</span>]<span class="sc">*</span><span class="fu">sqrt</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>n_t)))<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">#assume that prob of moving from sick to death is increasing linearly over cycles but more </span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>tm_control[<span class="dv">2</span>,<span class="dv">3</span>,] <span class="ot">&lt;-</span> tm_control[<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>] <span class="sc">+</span> (tm_control[<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>]<span class="sc">*</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>n_t))<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co">#assume that prob of moving from sick to well is constant</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>tm_control[<span class="dv">2</span>,<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">rep</span>(tm_control[<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>],n_t)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co">#fill in all other probabilities</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>tm_control[<span class="dv">1</span>,<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (tm_control[<span class="dv">1</span>,<span class="dv">2</span>,]<span class="sc">+</span>tm_control[<span class="dv">1</span>,<span class="dv">3</span>,])</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>tm_control[<span class="dv">2</span>,<span class="dv">2</span>,] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (tm_control[<span class="dv">2</span>,<span class="dv">1</span>,]<span class="sc">+</span>tm_control[<span class="dv">2</span>,<span class="dv">3</span>,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once the transition probabilities over the desired number of cycles are estimated/filled in, further data manipulation can be carried out to estimate the expected costs and effects, which can be included in an additional vector and then multiplied with the elements of the matrices after each cycle to generate the expected total costs and effects. As an example, let’s assume that patients were treated for <span class="math inline">\(3\)</span> months but followed up for <span class="math inline">\(12\)</span> months during the trial and that costs were collected from patients files and measured in euros, while effects were collected via self-reported questionnaires (e.g.&nbsp;EQ-5D) and measured via utilities. We need to associate to each health state and treatment in the model a corresponding value for each of the outcomes that we want to measure, i.e.&nbsp;costs and utilities. Thus, we may assume that (monthly) utilities for each health state and treatment are <span class="math inline">\(u^{well}=(0.78,0.70)\)</span>, <span class="math inline">\(u^{sick}=(0.40,0.35)\)</span>, and <span class="math inline">\(u^{dead}=(0,0)\)</span>. We may also assume that (monthly) costs vary between treatment groups and health states, i.e.&nbsp;<span class="math inline">\(c_{exp}=(954,1516,0)\)</span> and <span class="math inline">\(c^{ctr}=(435,780,0)\)</span>. Next, we need to determine the number of cycles of the model. In this case, we will use <span class="math inline">\(12\)</span> cycles given that we focus over a <span class="math inline">\(1\)</span> year follow-up, with each cycle being <span class="math inline">\(1\)</span> month long. Hence, the expected costs and QALYs for each month will be generated and then added up.</p>
<p>The proportion of patients in each of the health states at the start of the model needs to be determined, typically an arbitrary large number, e.g.&nbsp;<span class="math inline">\(1000\)</span>, since the idea is to estimate the cumulative costs and effects over the <span class="math inline">\(1000\)</span> patients for each group. We can now proceed to calculate the transition matrices and total costs and QALYs associated with both treatment groups over <span class="math inline">\(12\)</span> months via our Markov Model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#set up initial values for the model</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#utilities and costs by health state and treatment</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>u_well <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.78</span>,<span class="fl">0.70</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>u_sick <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.4</span>,<span class="fl">0.35</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>u_dead <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>c_exp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">954</span>,<span class="dv">1516</span>,<span class="dv">0</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>c_ctr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">435</span>,<span class="dv">780</span>,<span class="dv">0</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">#create function to run the model</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>mm_td_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(tm_exp,tm_ctr,u_well,u_sick,u_dead,c_exp,c_ctr,n_cycle,n_pat,n_state){</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  res_list <span class="ot">&lt;-</span> res_list_exp <span class="ot">&lt;-</span> res_list_ctr <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#assign state membership</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  state_membership_exp <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA_real_</span>, <span class="at">dim=</span><span class="fu">c</span>(n_cycle,n_state),</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                            <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">cycle=</span><span class="dv">1</span><span class="sc">:</span>n_cycle,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                            <span class="at">state =</span> <span class="fu">c</span>(<span class="st">"Well"</span>,<span class="st">"Sick"</span>,<span class="st">"Dead"</span>))) </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  state_membership_ctr <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA_real_</span>, <span class="at">dim=</span><span class="fu">c</span>(n_cycle,n_state),</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>                            <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">cycle=</span><span class="dv">1</span><span class="sc">:</span>n_cycle,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>                            <span class="at">state =</span> <span class="fu">c</span>(<span class="st">"Well"</span>,<span class="st">"Sick"</span>,<span class="st">"Dead"</span>))) </span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">#set people at start of cohort by health state</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  state_membership_exp[<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(n_pat,<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  state_membership_ctr[<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(n_pat,<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#compute state membership based on tp of the matrix specific to treatment</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n_cycle){</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    state_membership_exp[i,] <span class="ot">&lt;-</span> state_membership_exp[i<span class="dv">-1</span>,] <span class="sc">%*%</span> tm_exp[,,i<span class="dv">-1</span>]</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    state_membership_ctr[i,] <span class="ot">&lt;-</span> state_membership_ctr[i<span class="dv">-1</span>,] <span class="sc">%*%</span> tm_ctr[,,i<span class="dv">-1</span>]</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">#compute state membership for only those alive</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  state_membership_exp_alive <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(state_membership_exp[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  state_membership_ctr_alive <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(state_membership_ctr[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">#assign u and c values</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  payoffs_exp <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA_real_</span>, <span class="at">dim=</span><span class="fu">c</span>(n_state,<span class="dv">2</span>,n_cycle),</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>                   <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">state=</span><span class="fu">c</span>(<span class="st">"Well"</span>,<span class="st">"Sick"</span>,<span class="st">"Dead"</span>),</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">payoff=</span><span class="fu">c</span>(<span class="st">"Cost"</span>,<span class="st">"QALY"</span>),</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">cycle=</span><span class="dv">1</span><span class="sc">:</span>n_cycle))</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  payoffs_ctr <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA_real_</span>, <span class="at">dim=</span><span class="fu">c</span>(n_state,<span class="dv">2</span>,n_cycle),</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>                   <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">state=</span><span class="fu">c</span>(<span class="st">"Well"</span>,<span class="st">"Sick"</span>,<span class="st">"Dead"</span>),</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">payoff=</span><span class="fu">c</span>(<span class="st">"Cost"</span>,<span class="st">"QALY"</span>),</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">cycle=</span><span class="dv">1</span><span class="sc">:</span>n_cycle))</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  payoffs_exp[,,<span class="dv">1</span><span class="sc">:</span>n_cycle] <span class="ot">&lt;-</span> <span class="fu">c</span>(c_exp[<span class="dv">1</span>],c_exp[<span class="dv">2</span>],c_exp[<span class="dv">3</span>],u_well[<span class="dv">1</span>],u_sick[<span class="dv">1</span>],u_dead[<span class="dv">1</span>])</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  payoffs_ctr[,,<span class="dv">1</span><span class="sc">:</span>n_cycle] <span class="ot">&lt;-</span> <span class="fu">c</span>(c_ctr[<span class="dv">1</span>],c_ctr[<span class="dv">2</span>],c_ctr[<span class="dv">3</span>],u_well[<span class="dv">2</span>],u_sick[<span class="dv">2</span>],u_dead[<span class="dv">2</span>])</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">#apply u and c value based on state membership at each cycle</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>  payoff_trace_exp <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA_real_</span>,<span class="at">dim=</span><span class="fu">c</span>(n_cycle,<span class="dv">2</span>),</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>                        <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">cycle=</span><span class="dv">1</span><span class="sc">:</span>n_cycle,</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>                        <span class="at">payoff=</span><span class="fu">c</span>(<span class="st">"Cost"</span>,<span class="st">"QALY"</span>)))</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>  payoff_trace_ctr <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA_real_</span>,<span class="at">dim=</span><span class="fu">c</span>(n_cycle,<span class="dv">2</span>),</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>                        <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">cycle=</span><span class="dv">1</span><span class="sc">:</span>n_cycle,</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>                        <span class="at">payoff=</span><span class="fu">c</span>(<span class="st">"Cost"</span>,<span class="st">"QALY"</span>)))</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_cycle){</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    payoff_trace_exp[i,] <span class="ot">&lt;-</span> state_membership_exp[i,] <span class="sc">%*%</span> payoffs_exp[,,i]</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    payoff_trace_ctr[i,] <span class="ot">&lt;-</span> state_membership_ctr[i,] <span class="sc">%*%</span> payoffs_ctr[,,i]</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>  <span class="co">#save output</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>  res_list_exp[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> tm_exp</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>  res_list_exp[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> state_membership_exp</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>  res_list_exp[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> state_membership_exp_alive</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>  res_list_exp[[<span class="dv">4</span>]] <span class="ot">&lt;-</span> payoff_trace_exp[,<span class="dv">1</span>]</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>  res_list_exp[[<span class="dv">5</span>]] <span class="ot">&lt;-</span> payoff_trace_exp[,<span class="dv">2</span>]</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>  res_list_ctr[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> tm_ctr</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>  res_list_ctr[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> state_membership_ctr</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>  res_list_ctr[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> state_membership_ctr_alive</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>  res_list_ctr[[<span class="dv">4</span>]] <span class="ot">&lt;-</span> payoff_trace_ctr[,<span class="dv">1</span>]</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>  res_list_ctr[[<span class="dv">5</span>]] <span class="ot">&lt;-</span> payoff_trace_ctr[,<span class="dv">2</span>]</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(res_list_exp)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"TM"</span>,<span class="st">"npatients"</span>,<span class="st">"nalive"</span>,<span class="st">"costs"</span>,<span class="st">"QALYs"</span>)</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(res_list_ctr)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"TM"</span>,<span class="st">"npatients"</span>,<span class="st">"nalive"</span>,<span class="st">"costs"</span>,<span class="st">"QALYs"</span>)</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>  res_list[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> res_list_exp</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>  res_list[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> res_list_ctr</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(res_list)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Experimental"</span>,<span class="st">"Control"</span>)</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(res_list)</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a><span class="co">#run the function and get the output</span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>mm_td_res <span class="ot">&lt;-</span> <span class="fu">mm_td_sim</span>(<span class="at">tm_exp=</span>tm,<span class="at">tm_ctr=</span>tm_control,</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>                    <span class="at">u_well=</span>u_well,<span class="at">u_sick=</span>u_sick,<span class="at">u_dead=</span>u_dead,</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>                    <span class="at">c_exp=</span>c_exp,<span class="at">c_ctr=</span>c_ctr,<span class="at">n_cycle=</span>n_t,<span class="at">n_pat=</span>n_c,<span class="at">n_state=</span>n_s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For example, we can extract information regarding the number of patients associated with each health state at each cycle of the model for both intervention groups:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#experimental</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>mm_td_res<span class="sc">$</span>Experimental<span class="sc">$</span>npatients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     state
cycle        Well       Sick     Dead
   1  1000.000000   0.000000   0.0000
   2   444.500000 353.500000 202.0000
   3   213.331264 365.837500 420.8312
   4   111.311964 284.884539 603.8035
   5    62.330996 195.494745 742.1743
   6    36.454140 123.097697 840.4482
   7    21.615123  71.872795 906.5121
   8    12.676498  38.892356 948.4311
   9     7.222391  19.415242 973.3624
   10    3.949998   8.900266 987.1497
   11    2.059281   3.745816 994.1949
   12    1.021025   1.461167 997.5178</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#control</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>mm_td_res<span class="sc">$</span>Control<span class="sc">$</span>npatients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     state
cycle        Well       Sick     Dead
   1  1000.000000   0.000000   0.0000
   2   444.500000 353.500000 202.0000
   3   213.331264 365.837500 420.8312
   4   111.311964 284.884539 603.8035
   5    62.330996 195.494745 742.1743
   6    36.454140 123.097697 840.4482
   7    21.615123  71.872795 906.5121
   8    12.676498  38.892356 948.4311
   9     7.222391  19.415242 973.3624
   10    3.949998   8.900266 987.1497
   11    2.059281   3.745816 994.1949
   12    1.021025   1.461167 997.5178</code></pre>
</div>
</div>
<p>or the costs and QALYs accrued at each cycle across the alive patients</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#experimental</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>mm_td_res<span class="sc">$</span>Experimental<span class="sc">$</span>costs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         1          2          3          4          5          6          7 
954000.000 959959.000 758127.676 538076.576 355833.802 221393.359 129579.984 
         8          9         10         11         12 
 71054.191  36323.668  17261.102   7643.211   3189.187 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mm_td_res<span class="sc">$</span>Experimental<span class="sc">$</span>QALYs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         1          2          3          4          5          6          7 
780.000000 488.110000 312.733386 200.777148 126.816074  77.673308  45.608914 
         8          9         10         11         12 
 25.444611  13.399562   6.641105   3.104565   1.380866 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#control</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>mm_td_res<span class="sc">$</span>Control<span class="sc">$</span>costs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         1          2          3          4          5          6          7 
435000.000 469087.500 378152.350 270630.645 179599.884 111873.755  65463.358 
         8          9         10         11         12 
 35850.314  18285.629   8660.457   3817.523   1583.856 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>mm_td_res<span class="sc">$</span>Control<span class="sc">$</span>QALYs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         1          2          3          4          5          6          7 
700.000000 434.875000 277.375010 177.627964 112.054858  68.602092  40.286064 
         8          9         10         11         12 
 22.485873  11.851008   5.880092   2.752532   1.226126 </code></pre>
</div>
</div>
<p>from which an estimate of the mean costs and QALYs (and the group differences) over the <span class="math inline">\(12\)</span> months period (without discounting) can be obtained by taking the sum across these accrued expected values at each cycle</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#experimental</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>mu_c_exp <span class="ot">&lt;-</span> <span class="fu">sum</span>(mm_td_res<span class="sc">$</span>Experimental<span class="sc">$</span>costs)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>mu_e_exp <span class="ot">&lt;-</span> <span class="fu">sum</span>(mm_td_res<span class="sc">$</span>Experimental<span class="sc">$</span>QALYs)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">#control</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>mu_c_ctr <span class="ot">&lt;-</span> <span class="fu">sum</span>(mm_td_res<span class="sc">$</span>Control<span class="sc">$</span>costs)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>mu_e_ctr <span class="ot">&lt;-</span> <span class="fu">sum</span>(mm_td_res<span class="sc">$</span>Control<span class="sc">$</span>QALYs)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>mu_c_diff <span class="ot">&lt;-</span> mu_c_exp<span class="sc">-</span>mu_c_ctr</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>mu_e_diff <span class="ot">&lt;-</span> mu_e_exp<span class="sc">-</span>mu_e_ctr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and from this an estimate of the ICER can be obtained:</p>
<p><span class="math display">\[
\text{ICER} = \frac{4.0524418\times 10^{6} - 1.9780053\times 10^{6}}{2081.6895399-1855.0166193} =\frac{2.0744365\times 10^{6}}{226.6729206} = 9151.67
\]</span></p>
<p>and that’s it for today. I hope you found this interesting as there is lots more to come in the future!</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-caldwell2007decision" class="csl-entry" role="listitem">
Caldwell, Deborah. 2007. <span>“Decision Modelling for Health Economic Evaluation. A Briggs, m Sculpher, k Claxton.”</span> Oxford University Press.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2024, Andrea Gabrio</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>