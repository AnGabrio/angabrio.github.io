<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Andrea Gabrio">
<meta name="dcterms.date" content="2026-02-10">

<title>Survival Analysis – Andrea Gabrio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../img/icon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-91b29bb7e9f3845f2a6022c76ce085c6.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>

<link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Andrea Gabrio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../software.html"> 
<span class="menu-text">Software</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../missing_data.html"> 
<span class="menu-text">Missing Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials.html"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../teaching.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#the-survival-function" id="toc-the-survival-function" class="nav-link" data-scroll-target="#the-survival-function">The Survival Function</a>
  <ul class="collapse">
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  </ul></li>
  <li><a href="#the-kaplan-meier-estimate" id="toc-the-kaplan-meier-estimate" class="nav-link" data-scroll-target="#the-kaplan-meier-estimate">The Kaplan-Meier Estimate</a>
  <ul class="collapse">
  <li><a href="#example-1" id="toc-example-1" class="nav-link" data-scroll-target="#example-1">Example</a></li>
  </ul></li>
  <li><a href="#comparing-survival-functions-between-groups" id="toc-comparing-survival-functions-between-groups" class="nav-link" data-scroll-target="#comparing-survival-functions-between-groups">Comparing survival functions between groups</a>
  <ul class="collapse">
  <li><a href="#example-2" id="toc-example-2" class="nav-link" data-scroll-target="#example-2">Example</a></li>
  </ul></li>
  <li><a href="#the-log-rank-test" id="toc-the-log-rank-test" class="nav-link" data-scroll-target="#the-log-rank-test">The log-rank test</a>
  <ul class="collapse">
  <li><a href="#example-3" id="toc-example-3" class="nav-link" data-scroll-target="#example-3">Example</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Survival Analysis</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Quarto</div>
    <div class="quarto-category">R</div>
    <div class="quarto-category">Academia</div>
    <div class="quarto-category">Medical Statistics</div>
    <div class="quarto-category">Survival Analysis</div>
  </div>
  </div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://angabrio.github.io/agabriosite2/">Andrea Gabrio</a> <a href="https://orcid.org/0000-0002-7650-4534" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://www.maastrichtuniversity.nl/research/methodology-and-statistics">
            Maastricht University
            </a>
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 10, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Hello folks, I hope everything is well with you and welcome back to my regular blog update. This month nothing particularly exciting has happened to me, but I mostly spent my time catching up with some research collaborations and ideas, plus some usual teaching duties. Although we had a rough start of the year here in Maastricht (at least in terms of weather), now the situation seems a bit calmer and nicer. Overall, I cannot complain to much and need to find the time to finish off some left-off work, and I am talking of my <code>R</code> package <code>missingHE</code>, which will (hopefully) soon get a big update with a bunch of new content! But, before that, let me introduce the topic that I will be discussing today on my blog, that is a gentle presentation of some key concepts of <strong>Survival Analysis</strong>. I hope this topic is of interest to you and that you find this post helpful in case you were interested in approaching this field of statistics. Personally, I find the topic quite interesting and cool, although I am not an expert when it comes down to very advanced survival analysis methods. Today I will just touch upon some basic elements that assume no previous knowledge on the matter, so rest assured that most of the things I will discuss will make sense for someone who never heard of this topic before (I hope)!</p>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p><strong>Survival Data</strong> typically occur where times are recorded from a specific <em>time origin</em> until the occurrence of some pre-defined <em>event</em> of interest for a group of subjects (e.g.&nbsp;time until death following a heart transplant or disease diagnosis). Note that the event of interest does not need to be “death” but may, for instance, refer to the occurrence of remission from a disease or discharge from an hospital. Sometimes, survival data may be also referred to as <strong>time-to-event</strong> data. For example, we have considered in past posts the concept of a <em>rate</em> as an estimate of the probability of the occurrence of an event of interest within a given time frame. However, rate calculation rests on the quite strong assumption that the underlying risk does not change over time.</p>
<p>Key features of survival data typically include:</p>
<ul>
<li><p>Existence of times <span class="math inline">\(\geq 0\)</span>, thus unlikely to come from a Normal distribution.</p></li>
<li><p>Shape of empirical distributions that are positively skewed.</p></li>
<li><p>For some subjects, the time-to-event is unknown (e.g.&nbsp;still alive at the end of the period of follow-up), for whom we only know that the event of interest has not occurred before a certain time. In particular, a subject’s observed time is defined as <strong>censored</strong> if the event of interest has not occurred during the follow-up.</p></li>
</ul>
<p>Censoring may occur due to a variety of reasons, and may therefore be associated with different observed censoring features. For example, the event of interest may not occur during the follow-up because patients are still alive at the end of the study period, or because subjects are lost to follow-up (patients’ times are said to be <strong>right censored</strong>). Methods used for the analysis of survival data should account for censoring to avoid bias in the resulting estimates.</p>
<p>Right censoring is by far the most common type of censoring mechanism in medical studies. More technically, we talk about <strong>right censoring</strong> when a subject enters a study at time <span class="math inline">\(t_0\)</span> and experiences the event of interest at <span class="math inline">\(t_0+t\)</span>, but the study ends at time <span class="math inline">\(t_0+c\)</span>, where <span class="math inline">\(c&lt;t\)</span>. Thus, we only know that the subject experienced the event at some unknown time <span class="math inline">\(&gt; t_0 + c\)</span>, and we say that the subject’s time is right censored. Other possible types of censoring mechanism for the unknown time <span class="math inline">\(t\)</span> at which the subject experienced the event include: <strong>left censoring</strong>, where we only know that <span class="math inline">\(t&lt;c\)</span>; <strong>interval censoring</strong>, where we only know that <span class="math inline">\(c_1&lt;t&lt;c_2\)</span>.</p>
<p>In addition to the different types of censoring mechanisms, each of these may also be characterised by whether the censoring time is dependent or not on the reasons that lead to the creation of the censoring mechanism. In general, we say that censoring is <em>non-informative</em> if the actual unknown survival time is independent of the mechanism that caused the observation to become censored at some time <span class="math inline">\(c&lt;t\)</span>. This assumption implies that that a subject censored at time <span class="math inline">\(c\)</span> should be representative of all other subjects who have yet to experience the event of interest at time <span class="math inline">\(c\)</span>. When this is not true, i.e.&nbsp;subjects are censored for reasons related to their unknown survival time, censoring is said to be <em>informative</em> (e.g.&nbsp;a patient drops out from a study because their health deteriorates, likely leading to a lower survival time with respect to all the others still alive at the time of dropout).</p>
<section id="the-survival-function" class="level2">
<h2 class="anchored" data-anchor-id="the-survival-function">The Survival Function</h2>
<p>The survival time is measured from a specific origin, often given by randomisation or administration of treatment (RCTs) or by age, since recruitment or infection (observational studies). The variable of interest is the time to the event <span class="math inline">\(T\)</span>, which may not be observed for all subjects. Let us assume that we have a data set with data from <span class="math inline">\(N\)</span> subjects, and let <span class="math inline">\(i\)</span>-th denote the subject index for <span class="math inline">\(i=1,\ldots,N\)</span>. We subset the individuals into two separate groups: <span class="math inline">\(C=\)</span> set of censored subjects, and <span class="math inline">\(D=\)</span> set of fully-observed event of interest occurrences. Survival data are typically defined using the pair of variables <span class="math inline">\((t_i,\delta_i)\)</span>, where: <span class="math inline">\(t_i=\)</span> time to event of interest if <span class="math inline">\(i \in D\)</span> or censoring time if <span class="math inline">\(i \in C\)</span>; <span class="math inline">\(\delta_i=\)</span> 1 if <span class="math inline">\(i \in D\)</span> (event experienced) or 0 if <span class="math inline">\(i \in C\)</span> (subject censored).</p>
<p>Using the pair <span class="math inline">\((t_i,\delta_i)\)</span>, we can now summarise survival data using a <strong>survival function</strong>. In particular, let <span class="math inline">\(S(t)\)</span> denote the survival function given by:</p>
<p><span class="math display">\[
S(t) = P(T&gt;t)=1-F(t),
\]</span> where <span class="math inline">\(T\)</span> denotes the survival time (i.e.&nbsp;time to the event) random variable with probability density function <span class="math inline">\(f(t)\)</span> and cumulative distribution function <span class="math inline">\(F(t)\)</span>. The survival function <span class="math inline">\(S(t)\)</span> measures the probability that a subject experiences the event beyond time <span class="math inline">\(t\)</span>. If no subject is censored, we could use the following empirical estimate of the function at each time <span class="math inline">\(t\)</span>:</p>
<p><span class="math display">\[
\hat{S}(t) = \frac{\text{Number of subjects with survival time} \geq t}{\text{Total number of subjects in the data set}},
\]</span></p>
<p>assuming <span class="math inline">\(\hat{S}(t)\)</span> remains constant between event times.</p>
<section id="example" class="level3">
<h3 class="anchored" data-anchor-id="example">Example</h3>
<p>The following survival times are recorded for 10 patients from a study on multiple myeloma</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] 23 41 32 83  5 62 96 71 90 54</code></pre>
</div>
</div>
<p>and their empirical survival function may be graphically represented as</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="the-kaplan-meier-estimate" class="level2">
<h2 class="anchored" data-anchor-id="the-kaplan-meier-estimate">The Kaplan-Meier Estimate</h2>
<p>When censoring occurs in a data set, we cannot use the empirical estimate of the survival function but we use its <strong>Kaplan-Meier estimate</strong> instead, which is calculated as follows:</p>
<ul>
<li><p>First, order the <em>failure times</em> (times where an event occurs in the data) from smallest to largest. Assuming <span class="math inline">\(n\)</span> failures, we write these as <span class="math inline">\(t(1)&lt; \ldots &lt; t(n)\)</span>.</p></li>
<li><p>Second, consider <span class="math inline">\(n-1\)</span> intervals where each starts with a failure time and ends just before the next ordered failure time. Another interval runs from <span class="math inline">\(t(0)\)</span> until just before the first failure time. We write these as <span class="math inline">\([t(0),t(1)), \ldots, [t(n),\infty)\)</span>.</p></li>
<li><p>Third, we define <span class="math inline">\(n_j=\)</span> number of subjects at the beginning of the interval <span class="math inline">\([t(j),t(j+1))\)</span> who are uncensored and have not experienced the event, and <span class="math inline">\(d_j=\)</span> number of failures (subjects who experienced the event) during the interval <span class="math inline">\([t(j),t(j+1))\)</span>.</p></li>
<li><p>Fourth, the probability of surviving the interval <span class="math inline">\([t(j),t(j+1))\)</span> is given by <span class="math inline">\(\hat{p}_j=\frac{n_j-d_j}{n_j}\)</span>.</p></li>
<li><p>Fifth, the KM estimate of the survival function for <span class="math inline">\(t \in [t(k),t(k+1))\)</span> is <span class="math inline">\(\hat{S}(t)=\prod_{j=1}^k \hat{p}_j\)</span>.</p></li>
</ul>
<section id="example-1" class="level3">
<h3 class="anchored" data-anchor-id="example-1">Example</h3>
<p>Consider the following 18 times until discontinuation of an intrauterine device in a study on the side effects of contraceptives, where censored times are labelled with a value of 0 in the corresponding indicator variable (<span class="math inline">\(\delta\)</span>).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   times delta
1     10     1
2     13     0
3     18     0
4     19     1
5     23     0
6     30     1
7     36     1
8     38     0
9     54     0
10    56     0
11    59     1
12    75     1
13    93     1
14    97     1
15   104     0
16   107     1
17   107     0
18   107     0</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Given that survival data are usually skewed, we are often interested in estimating the median survival time, i.e.&nbsp;the smallest time <span class="math inline">\(t\)</span> for which <span class="math inline">\(\hat{S}(t)&lt;0.5\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In many cases we want to compare survival function estimates of two groups of interest.</p>
</section>
</section>
<section id="comparing-survival-functions-between-groups" class="level2">
<h2 class="anchored" data-anchor-id="comparing-survival-functions-between-groups">Comparing survival functions between groups</h2>
<section id="example-2" class="level3">
<h3 class="anchored" data-anchor-id="example-2">Example</h3>
<p><span class="citation" data-cites="kirk1980late">Kirk et al. (<a href="#ref-kirk1980late" role="doc-biblioref">1980</a>)</span> reported findings from a trial of prednisolone in <span class="math inline">\(44\)</span> patients with chronic active hepatitis, randomised to either receiving prednisolone (<span class="math inline">\(n=22\)</span>) or placebo (<span class="math inline">\(n=22\)</span>), with the outcome of interest being survival time (time until death). The survival times (in months) of the two groups of patients are given below, with associated censoring times.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   placebo t placebo delta prednis t prednis delta
1          2             1         2             1
2          3             1         6             1
3          4             1        12             1
4          7             1        54             1
5         10             1        56             0
6         22             1        68             1
7         28             1        89             1
8         29             1        96             1
9         32             1        96             1
10        37             1       125             0
11        40             1       128             0
12        41             1       131             0
13        54             1       140             0
14        61             1       141             0
15        63             1       143             1
16        71             1       145             0
17       127             0       146             1
18       140             0       148             0
19       146             0       162             0
20       158             0       168             1
21       167             0       173             0
22       188             0       181             0</code></pre>
</div>
</div>
<p>The aim is to compare the survival functions between the groups, i.e.&nbsp;does the survival rate differ between the groups? We may start by comparing the KM estimates of <span class="math inline">\(S(t)\)</span> for the two groups. Here, to make things easier for me, I will use the functions <code>survfit()</code> and <code>ggsurvplot()</code>, from the packages <code>survival</code> and <code>survminer</code>, to generate and plot KM estimates for the two groups, respectively.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="the-log-rank-test" class="level2">
<h2 class="anchored" data-anchor-id="the-log-rank-test">The log-rank test</h2>
<p>Looking at the plots it seems that the estimated survival function decreases more rapidly over time for the placebo group. Now, can adopt an hypothesis test to assess formally whether there is any significant difference in survival between the two groups? For example, we can use a non-parametric <strong>log-rank test</strong> to test the null hypothesis that the survival functions are the same for the two groups. More generally, where there are <span class="math inline">\(K\)</span> groups, the test statistic is</p>
<p><span class="math display">\[
\chi^2 = \sum_{i=1}^K \frac{(O_i - E_i)^2}{E_i},
\]</span></p>
<p>where <span class="math inline">\(O_i\)</span> and <span class="math inline">\(E_i\)</span> are the observed and expected (under the null hypothesis) number of deaths in the <span class="math inline">\(i-th\)</span> group. In particular, under <span class="math inline">\(H_0\)</span> we know that <span class="math inline">\(\chi^2 \sim \chi^2_{K-1}\)</span>. The test is valid only if the KM plots of the survival functions for the groups do not intersect, an assumption known as <em>proportional hazards</em>.</p>
<p>To calculate the expected number of deaths (<span class="math inline">\(E_i\)</span>), we do the following:</p>
<ol type="1">
<li><p>Order the event times from smallest to largest across all groups.</p></li>
<li><p>At each ordered death time we count: the number of subjects alive and uncensored in each group immediately prior to that time; and the number of events at that time.</p></li>
<li><p>The expected number of deaths in group <span class="math inline">\(i\)</span> is then calculated as the fraction of alive and uncensored subjects in group <span class="math inline">\(i\)</span> at the time multiplied by the number of events (across all groups) at that time.</p></li>
<li><p>Within each group, the expected numbers of events are summed across all ordered event times to calculate <span class="math inline">\(E_i\)</span> for each <span class="math inline">\(i\)</span>.</p></li>
</ol>
<p>For example, with two groups (<span class="math inline">\(i=1,2\)</span>) and an event time <span class="math inline">\(t(j)\)</span>, we write:</p>
<ul>
<li><span class="math inline">\(n_{ij}=\)</span> number of subjects alive and uncensored at start in group <span class="math inline">\(i\)</span>.</li>
<li><span class="math inline">\(d_{ij}=\)</span> number of events at <span class="math inline">\(t(j)\)</span> in group <span class="math inline">\(i\)</span>.</li>
<li><span class="math inline">\(n_j\)</span> and <span class="math inline">\(d_j\)</span> are the number of subjects alive and uncensored at start and the number of events at <span class="math inline">\(t(j)\)</span> across groups.</li>
</ul>
<p>The expected number of deaths in group <span class="math inline">\(i\)</span> is then: <span class="math inline">\(e_{ij}=\frac{n_{ij}d_j}{n_j}\)</span>. If there are <span class="math inline">\(r\)</span> ordered event times, then the overall expected number of deaths in group <span class="math inline">\(i\)</span> is: <span class="math inline">\(E_i=\sum_{j=1}^r=e_{ij}\)</span>.</p>
<section id="example-3" class="level3">
<h3 class="anchored" data-anchor-id="example-3">Example</h3>
<p>The following table shows survival times (in days) from a study of breast cancer patients, stratified according to their age group at the start of the study: group 1 (60 years or under), group 2 (over 60). For the death column, 1 indicates that a death occurred whereas a 0 denotes censoring.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">ID</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Group</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Time</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Death</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">2</td>
<td style="text-align: right;">413</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">701</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">2</td>
<td style="text-align: right;">1075</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">1735</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">2</td>
<td style="text-align: right;">1801</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">2989</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: left;">2</td>
<td style="text-align: right;">3044</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: left;">2</td>
<td style="text-align: right;">3351</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: left;">2</td>
<td style="text-align: right;">5551</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: left;">2</td>
<td style="text-align: right;">6277</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">7293</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">7352</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">13</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">7434</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>For example, at death time <span class="math inline">\(t(j)=413\)</span>, we compute the following quantities:</p>
<ul>
<li><span class="math inline">\(n_{1j}=6\)</span>; <span class="math inline">\(d_{1j}=0\)</span>; <span class="math inline">\(n_{2j}=7\)</span>; <span class="math inline">\(d_{2j}=1\)</span>; <span class="math inline">\(e_{1j}=6/13=0.46\)</span>; <span class="math inline">\(e_{2j}=7/13=0.54\)</span></li>
</ul>
<p>and, at death time <span class="math inline">\(t(j)=1075\)</span>:</p>
<ul>
<li><span class="math inline">\(n_{1j}=5\)</span>; <span class="math inline">\(d_{1j}=0\)</span>; <span class="math inline">\(n_{2j}=6\)</span>; <span class="math inline">\(d_{2j}=1\)</span>; <span class="math inline">\(e_{1j}=5/11=0.45\)</span>; <span class="math inline">\(e_{2j}=6/11=0.55\)</span>.</li>
</ul>
<p>Repeating this for all death times:</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">t(j)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">n1j</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">d1j</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">n2j</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">d2j</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">e1j</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">e2j</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">413</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.46</td>
<td style="text-align: right;">0.54</td>
</tr>
<tr class="even">
<td style="text-align: right;">1075</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">0.55</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1735</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0.50</td>
</tr>
<tr class="even">
<td style="text-align: right;">1801</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: right;">0.56</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2989</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0.50</td>
</tr>
<tr class="even">
<td style="text-align: right;">3044</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.43</td>
<td style="text-align: right;">0.57</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3351</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0.50</td>
</tr>
<tr class="even">
<td style="text-align: right;">5551</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.60</td>
<td style="text-align: right;">0.40</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6277</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.75</td>
<td style="text-align: right;">0.25</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>So, we can sum up the column values to get <span class="math inline">\(O_1=2\)</span>, <span class="math inline">\(O_2=7\)</span>, <span class="math inline">\(E_1=4.64\)</span>, <span class="math inline">\(E_2=4.36\)</span>, where it must always be that <span class="math inline">\(O_1+O_2=E_1+E_2\)</span>. The test statistic is then:</p>
<p><span class="math display">\[
\chi^2 = \sum_{i=1}^2 \frac{(O_i - E_i)^2}{E_i} = 3.10,
\]</span> and under <span class="math inline">\(H_0\)</span> we assume that the it has a <span class="math inline">\(\chi^2\)</span> distribution with degrees of freedom equal to the number of groups minus one (1), and compute the corresponding p-value of <span class="math inline">\(P(Z&gt;3.10)=0.078\)</span>, therefore suggesting that there is not enough evidence to conclude that the two survival distributions differ.</p>
</section>
</section>
</section>
<section id="conclusions" class="level1">
<h1>Conclusions</h1>
<p>Survival analysis methods are applicable to:</p>
<ul>
<li><p>Randomised trials where we observe time-to-event outcomes for patients in each group.</p></li>
<li><p>Observational cohort studies where a specific group is followed over time and time data are collected until the event of interest.</p></li>
</ul>
<p>However, they are not applicable to case-control or cross-sectional studies.</p>
<p>For today that’ all dear readers, and I hope you find this topic interesting as there is much more to talk about. I was actually surprised that it took quite some time for me to replicate all the above steps and approaches in <code>R</code> (without relying too much on pre-defined already existing functions), but I am glad I was able to make it. If someone would be interested in having a look at the code that I wrote in base <code>R</code>, feel free to ask me. In the meantime, I would like to say goodbye and till the next time.</p>
</section>
<section id="references" class="level1">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-kirk1980late" class="csl-entry" role="listitem">
Kirk, AP, S Jain, Set al Pocock, HC Thomas, and SHEILA Sherlock. 1980. <span>“Late Results of the Royal Free Hospital Prospective Controlled Trial of Prednisolone Therapy in Hepatitis b Surface Antigen Negative Chronic Active Hepatitis.”</span> <em>Gut</em> 21 (1): 78–83.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2024, Andrea Gabrio</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>