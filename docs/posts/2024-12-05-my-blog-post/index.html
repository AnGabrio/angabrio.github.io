<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Andrea Gabrio">
<meta name="dcterms.date" content="2024-12-05">

<title>Markov Models in Economic Evaluations - II – Andrea Gabrio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../img/icon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Andrea Gabrio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../software.html"> 
<span class="menu-text">Software</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../missing_data.html"> 
<span class="menu-text">Missing Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials.html"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#base-case-markov-model" id="toc-base-case-markov-model" class="nav-link active" data-scroll-target="#base-case-markov-model">Base-case Markov Model</a></li>
  <li><a href="#what-about-uncertainty" id="toc-what-about-uncertainty" class="nav-link" data-scroll-target="#what-about-uncertainty">What about uncertainty?</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Markov Models in Economic Evaluations - II</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Quarto</div>
    <div class="quarto-category">R</div>
    <div class="quarto-category">Academia</div>
    <div class="quarto-category">Health Economics</div>
  </div>
  </div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://angabrio.github.io/agabriosite2/">Andrea Gabrio</a> <a href="https://orcid.org/0000-0002-7650-4534" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://www.maastrichtuniversity.nl/research/methodology-and-statistics">
            Maastricht University
            </a>
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 5, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="featured.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Hello folks and welcome back to my blog for a new post babbling about statistical methods in health economics!. Today I simply want to close the topic initiated in my last post on the bases of Markov Models, where I introduced the method, its objectives in the health economic context, and present a very simple structure to describe the key ideas underlying the approach. As I mentioned in that post, I would like to refer to proper references, such as <span class="citation" data-cites="khan2015design">Khan (<a href="#ref-khan2015design" role="doc-biblioref">2015</a>)</span>, if you are interested in the topic and would like to have a more in-depth look at how these models work and implement a more advanced structure. In my previous post you will also find some links to online websites and pages which show how such models can be implemented using software packages such as <code>R</code>.</p>
<section id="base-case-markov-model" class="level2">
<h2 class="anchored" data-anchor-id="base-case-markov-model">Base-case Markov Model</h2>
<p>Throughout this post I will assume that the reader is already familiar with the basic structure of Markov Models and the specific terminology used to denote key components of this approach, including the concepts of <em>transition matrix</em>, <em>transition probability</em>, and <em>cycle</em>. If this is not true, I recommend that you first check some references on the topic or read my previous post about this. I will also consider the same Markov Model example introduced in my previous post, formed by three health states (Well, Sick and Dead), and whose objective is to estimate the expected difference in Costs and QALYs over a period of <span class="math inline">\(12\)</span> cycles, each of <span class="math inline">\(1\)</span> month, between a new Experimental intervention and a Control group.</p>
<p>For our base-case analysis, let’s assume treatment-specific <span class="math inline">\(3\times3\)</span> transition matrices (<span class="math inline">\(P^{exp},P^{ctr}\)</span>), associating the three health states, and <span class="math inline">\(1\times3\)</span> matrices of initial probabilities (<span class="math inline">\(M^{exp}_0,M^{ctr}_{0}\)</span>). These transition matrices are first used to update the initial probabilities at the end of the first cycle, and then iteratively used to generate updated matrices at each follow-up cycle. As for the health economic outcomes, let’s assume (monthly) utility values for each health state in the model: <span class="math inline">\(u^{well}=0.78\)</span>, <span class="math inline">\(u^{sick}=0.40\)</span>, <span class="math inline">\(u^{dead}=0\)</span>, which are constant across treatments. Conversely, we assume (monthly) costs which are constant across health states but vary between treatment groups: <span class="math inline">\(c_{exp}=954\)</span>, <span class="math inline">\(c^{ctr}=435\)</span>. Let’s set the proportion of patients in each of the health states at the start of the model to be <span class="math inline">\(10000\)</span>, and proceed to calculate the transition matrices and total costs and QALYs associated with both treatment groups over <span class="math inline">\(12\)</span> months via our base-case Markov Model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#set up initial values for the model</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#initial transition probs by arm</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>tm_exp_init <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.45</span>,<span class="fl">0.35</span>,<span class="fl">0.2</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>tm_ctr_init <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.25</span>,<span class="fl">0.25</span>,<span class="fl">0.50</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#transition matrices by arm</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>tm_exp_update <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">0.45</span>,<span class="fl">0.05</span>,<span class="dv">0</span>,<span class="fl">0.35</span>,<span class="fl">0.6</span>,<span class="dv">0</span>,<span class="fl">0.2</span>,<span class="fl">0.35</span>,<span class="dv">1</span>),<span class="dv">3</span>,<span class="dv">3</span>) </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>tm_ctr_update <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">0.25</span>,<span class="fl">0.10</span>,<span class="dv">0</span>,<span class="fl">0.25</span>,<span class="fl">0.45</span>,<span class="dv">0</span>,<span class="fl">0.50</span>,<span class="fl">0.45</span>,<span class="dv">1</span>),<span class="dv">3</span>,<span class="dv">3</span>) </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#utilities by health state</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>u_well <span class="ot">&lt;-</span> <span class="fl">0.78</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>u_sick <span class="ot">&lt;-</span> <span class="fl">0.4</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>u_dead <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">#costs by arm</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>c_exp <span class="ot">&lt;-</span> <span class="dv">954</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>c_ctr <span class="ot">&lt;-</span> <span class="dv">435</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">#number of cycles</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>n_cycle <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">#initial number of patients in the cohort</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>n_pat <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co">#end of cycle 1 TP</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>trans_mat_cycle1_exp <span class="ot">&lt;-</span> tm_exp_init<span class="sc">%*%</span>tm_exp_update</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>trans_mat_cycle1_ctr <span class="ot">&lt;-</span> tm_ctr_init<span class="sc">%*%</span>tm_ctr_update</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">#lists to store TP results by cycle</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>trans_mat_cycles_exp <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>trans_mat_cycles_ctr <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co">#create function to run the model</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>mm_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(tm_exp_init,tm_ctr_init,tm_exp_update,tm_ctr_update,</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>                   u_well,u_sick,u_dead,c_exp,c_ctr,n_cycle,n_pat){</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  res_list <span class="ot">&lt;-</span> res_list_exp <span class="ot">&lt;-</span> res_list_ctr <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">#set up matrices to contain results from all TP over each cycle by group</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  tm_exp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_cycle<span class="sc">+</span><span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(tm_exp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Well"</span>,<span class="st">"Sick"</span>,<span class="st">"Dead"</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  tm_ctr <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_cycle<span class="sc">+</span><span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(tm_ctr) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Well"</span>,<span class="st">"Sick"</span>,<span class="st">"Dead"</span>)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">#assign first row to be initial TP</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  tm_exp[<span class="dv">1</span>,] <span class="ot">&lt;-</span> tm_exp_init</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  tm_ctr[<span class="dv">1</span>,] <span class="ot">&lt;-</span> tm_ctr_init</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">#loop through cycles and update TM at each cycle</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">c</span>(n_cycle<span class="sc">+</span><span class="dv">1</span>)){</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    tm_exp[i,] <span class="ot">&lt;-</span> tm_exp[i<span class="dv">-1</span>,]<span class="sc">%*%</span>tm_exp_update</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    tm_ctr[i,] <span class="ot">&lt;-</span> tm_ctr[i<span class="dv">-1</span>,]<span class="sc">%*%</span>tm_ctr_update</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  <span class="co">#remove intial TP from matrices</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>  tm_exp <span class="ot">&lt;-</span> tm_exp[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  tm_ctr <span class="ot">&lt;-</span> tm_ctr[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>  <span class="co">#using obtained TM to compute number of patients in each health state at each cycle</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  npat_cycle_exp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_cycle<span class="sc">+</span><span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(npat_cycle_exp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Well"</span>,<span class="st">"Sick"</span>,<span class="st">"Dead"</span>)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>  npat_cycle_ctr <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_cycle<span class="sc">+</span><span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(npat_cycle_ctr) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Well"</span>,<span class="st">"Sick"</span>,<span class="st">"Dead"</span>)</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  npat_cycle_exp <span class="ot">&lt;-</span> tm_exp<span class="sc">*</span>n_pat</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  npat_cycle_ctr <span class="ot">&lt;-</span> tm_ctr<span class="sc">*</span>n_pat</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>  <span class="co">#and number still alive</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  nailive_cycle_exp <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">rowSums</span>(npat_cycle_exp[,<span class="sc">-</span><span class="dv">3</span>]))</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(nailive_cycle_exp) <span class="ot">&lt;-</span> <span class="st">"nalive"</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  nailive_cycle_ctr <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">rowSums</span>(npat_cycle_ctr[,<span class="sc">-</span><span class="dv">3</span>]))</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(nailive_cycle_ctr) <span class="ot">&lt;-</span> <span class="st">"nalive"</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  <span class="co">#use obtained number of patients at each cycle to get the same for costs and QALYs</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  costs_cycle_exp <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">rowSums</span>(<span class="fu">as.matrix</span>(tm_exp<span class="sc">*</span>c_exp)[,<span class="sc">-</span><span class="dv">3</span>]))</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(costs_cycle_exp) <span class="ot">&lt;-</span> <span class="st">"costs"</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>  costs_cycle_ctr <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">rowSums</span>(<span class="fu">as.matrix</span>(tm_ctr<span class="sc">*</span>c_ctr)[,<span class="sc">-</span><span class="dv">3</span>]))</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(costs_cycle_ctr) <span class="ot">&lt;-</span> <span class="st">"costs"</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>  QALY_cycle_exp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_cycle<span class="sc">+</span><span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(QALY_cycle_exp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Well"</span>,<span class="st">"Sick"</span>,<span class="st">"Dead"</span>)</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>  QALY_cycle_ctr <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_cycle<span class="sc">+</span><span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(QALY_cycle_ctr) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Well"</span>,<span class="st">"Sick"</span>,<span class="st">"Dead"</span>)</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>  u_well_v <span class="ot">&lt;-</span> <span class="fu">rep</span>(u_well,n_cycle)</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>  u_sick_v <span class="ot">&lt;-</span> <span class="fu">rep</span>(u_sick,n_cycle)</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>  u_dead_v <span class="ot">&lt;-</span> <span class="fu">rep</span>(u_dead,n_cycle)</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>  u_M <span class="ot">&lt;-</span> <span class="fu">cbind</span>(u_well_v,u_sick_v,u_dead_v)</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>  QALY_cycle_exp <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">rowSums</span>(<span class="fu">as.matrix</span>(tm_exp<span class="sc">*</span>u_M)[,<span class="sc">-</span><span class="dv">3</span>]))</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(QALY_cycle_exp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"QALYs"</span>)</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>  QALY_cycle_ctr <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">rowSums</span>(<span class="fu">as.matrix</span>(tm_ctr<span class="sc">*</span>u_M)[,<span class="sc">-</span><span class="dv">3</span>]))</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(QALY_cycle_ctr) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"QALYs"</span>)</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>  <span class="co">#save output</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>  res_list_exp[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> tm_exp</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>  res_list_exp[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> npat_cycle_exp</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>  res_list_exp[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> nailive_cycle_exp</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>  res_list_exp[[<span class="dv">4</span>]] <span class="ot">&lt;-</span> costs_cycle_exp</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>  res_list_exp[[<span class="dv">5</span>]] <span class="ot">&lt;-</span> QALY_cycle_exp</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>  res_list_ctr[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> tm_ctr</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>  res_list_ctr[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> npat_cycle_ctr</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>  res_list_ctr[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> nailive_cycle_ctr</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>  res_list_ctr[[<span class="dv">4</span>]] <span class="ot">&lt;-</span> costs_cycle_ctr</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>  res_list_ctr[[<span class="dv">5</span>]] <span class="ot">&lt;-</span> QALY_cycle_ctr</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(res_list_exp)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"TM"</span>,<span class="st">"npatients"</span>,<span class="st">"nalive"</span>,<span class="st">"costs"</span>,<span class="st">"QALYs"</span>)</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(res_list_ctr)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"TM"</span>,<span class="st">"npatients"</span>,<span class="st">"nalive"</span>,<span class="st">"costs"</span>,<span class="st">"QALYs"</span>)</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>  res_list[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> res_list_exp</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>  res_list[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> res_list_ctr</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(res_list)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Experimental"</span>,<span class="st">"Control"</span>)</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(res_list)</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a><span class="co">#run the function and get the output</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>mm_res <span class="ot">&lt;-</span> <span class="fu">mm_sim</span>(<span class="at">tm_exp_init =</span> tm_exp_init, <span class="at">tm_ctr_init =</span> tm_ctr_init, <span class="at">tm_exp_update =</span> tm_exp_update,</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>       <span class="at">tm_ctr_update =</span> tm_ctr_update, <span class="at">u_well =</span> u_well, <span class="at">u_sick =</span> u_sick, <span class="at">u_dead =</span> u_dead, <span class="at">c_exp =</span> c_exp,</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>       <span class="at">c_ctr =</span> c_ctr, <span class="at">n_cycle =</span> n_cycle, <span class="at">n_pat =</span> n_pat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Based on the output of the model, we can retrieve an estimate of the mean costs and QALYs (and the group differences) over the <span class="math inline">\(12\)</span> months period (without discounting) by taking the sum across all QALYs and Costs expected values accrued at each cycle. These are summarised and presented in <a href="#tbl-base-mm" class="quarto-xref">Table&nbsp;1</a>.</p>
<div class="cell">
<div id="tbl-base-mm" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-base-mm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Base-case results from Markov Model
</figcaption>
<div aria-describedby="tbl-base-mm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Experimental</th>
<th style="text-align: right;">Control</th>
<th style="text-align: right;">Difference</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">QALYs</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">0.29</td>
<td style="text-align: right;">0.66</td>
</tr>
<tr class="even">
<td style="text-align: left;">Costs</td>
<td style="text-align: right;">1798.00</td>
<td style="text-align: right;">245.00</td>
<td style="text-align: right;">1553.00</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>From these estimates, we can then compute the value of the estimated <span class="math inline">\(\text{ICER}=\frac{1553}{0.66}=2344\)</span>, representing the incremental cost per unit of QALY gained associated with using the Experimental intervention compared to the Control group. If the decision-maker provides a specific value for their willingness to pay threshold, say <span class="math inline">\(K=20000\)</span> euros per QALY gained, then it is also possible to make a decision on whether to consider the intervention cost-effective or not. In our example, since <span class="math inline">\(\text{ICER}=2344&lt; K = 20000\)</span>, then we would conclude that the intervention is cost-effective. Similarly, using the <em>net benefit</em> framework, we could compute the quantity <span class="math inline">\(\text{NB}=K\times \mu_{\Delta_e} - \mu_{\Delta_c}= 20000 \times 0.66 - 1553=1.1696\times 10^{4}\)</span>, and since this is <span class="math inline">\(&gt;0\)</span>, we would also conclude that the intervention is cost-effective.</p>
</section>
<section id="what-about-uncertainty" class="level2">
<h2 class="anchored" data-anchor-id="what-about-uncertainty">What about uncertainty?</h2>
<p>A general problem of the decision made based on the results from the base-case analysis is that it completely ignores any type of uncertainty surrounding the input parameters of the models, i.e.&nbsp;transition probabilities, initial probabilities, utilities associated with each health state, and costs associated with each group. Indeed, since only specific values for each of these inputs was chosen, the results can only be valid conditional on these input values to be exactly correct. In reality, health economists are often uncertain about the reliability of these inputs of the model as these are typically collected from the literature, based on expert opinions, or even simply guessed based on some assumptions and the context considered. This, however, means that we should not blindly trust the results from analyses that are quite restrictive with respect to the input values assigned to the model. Rather, a much more reliable picture of the results can be obtained when these inputs are varied over a range of plausible values to assess the impact of their variation on the model conclusions. Were the results very sensitive to variations of these input values, then this would imply the presence of a quite large impact of parameter uncertainty on the conclusions of the model, which should be taken into account when expressing any decision in terms of cost-effectiveness. This is why the practice of varying input values to assess their impact on model results, also known as <em>sensitivity analysis</em>, is a mandatory requirement when assessing cost-effectiveness of interventions, particularly in the context of decision analytic models (e.g.&nbsp;Markov Models), whose input value choices are likely to strongly determine the results of the analysis.</p>
<p>There are many different types of sensitivity analysis that can be implemented to assess the results of a Markov Model, which are mainly distinguished based the approach used to vary the values of the inputs. One of the simplest form of sensitivity analysis is called <em>One-Way sensitivity analysis</em> and corresponds in varying the values of one input at a time, typically over a pre-defined grid of values (e.g.&nbsp;<span class="math inline">\(2\)</span>), and re-run the model based on the newly updated value for that specific input. This is then repeated for each value chosen for each model input to generate the same type of output of the base-case model but replicated for each new value selected for each model input varied. A slightly more complex approach takes the name of <em>Two-Way sensitivity analysis</em>, where the same procedure of the One-Way approach is used with the difference at each time the model is re-run the value of not one but two model inputs are changed simultaneously when generating the updated results. This is then repeated for each pair of inputs across the range of values that need to be assessed for each model input.</p>
<p>Although useful, these types of sensitivity analyses, called “deterministic”, are limited in that they can only explore the impact of variation of the input values conditional on all or most of the other input-values remaining constant, which may not be a realistic approach when assessing the impact of uncertainty on multiple model inputs. To overcome these limitations, a different approach called <em>probabilistic sensitivity analysis</em> (PSA) is used to quantify the impact associated with the simultaneous variation of all model inputs on the results. This is typically achieved through the use of probability distributions which allow to parameterise in a convenient way the level of uncertainty associated with each input in the model. For example, we may want to use a Uniform distribution to express our level of uncertainty around the transition probability value between the health state Well and Sick in each treatment arm, centering these distributions around the assumed value in the determinsitic analysis as a good starting point. We can do the same with other model parameters, such as expected QALYs and costs associated with each health state/treatment, taking care that appropriate probability distributions are used to express our level of uncertainty around specific parameter values. Let’s now try to replicate the model run before using these distributions to account for this sort of uncertainty.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#set number of model replications to account for parameter uncertainty</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#set up initial values for the model</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#in PSA these can be used to define mean values of the distributions</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#assigned to each parameter</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#initial transition probs by arm</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>tm_exp_init_mu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.45</span>,<span class="fl">0.35</span>,<span class="fl">0.2</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>tm_ctr_init_mu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.25</span>,<span class="fl">0.25</span>,<span class="fl">0.50</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">#transition matrices by arm</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>tm_exp_update_mu <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">0.45</span>,<span class="fl">0.05</span>,<span class="dv">0</span>,<span class="fl">0.35</span>,<span class="fl">0.6</span>,<span class="dv">0</span>,<span class="fl">0.2</span>,<span class="fl">0.35</span>,<span class="dv">1</span>),<span class="dv">3</span>,<span class="dv">3</span>) </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>tm_ctr_update_mu <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">0.25</span>,<span class="fl">0.10</span>,<span class="dv">0</span>,<span class="fl">0.25</span>,<span class="fl">0.45</span>,<span class="dv">0</span>,<span class="fl">0.50</span>,<span class="fl">0.45</span>,<span class="dv">1</span>),<span class="dv">3</span>,<span class="dv">3</span>) </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">#utilities by health state</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>u_well_mu <span class="ot">&lt;-</span> <span class="fl">0.78</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>u_sick_mu <span class="ot">&lt;-</span> <span class="fl">0.4</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>u_dead_mu <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">#costs by arm</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>c_exp_mu <span class="ot">&lt;-</span> <span class="dv">954</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>c_ctr_mu <span class="ot">&lt;-</span> <span class="dv">435</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co">#number of cycles</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>n_cycle <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co">#initial number of patients in the cohort</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>n_pat <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="co">#create function to run the model</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>mm_sim_psa <span class="ot">&lt;-</span> <span class="cf">function</span>(tm_exp_init_mu,tm_ctr_init_mu,tm_exp_update_mu,tm_ctr_update_mu,</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>                   u_well_mu,u_sick_mu,u_dead_mu,c_exp_mu,c_ctr_mu,n_cycle,n_pat,S){</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  res_list <span class="ot">&lt;-</span> res_list_exp <span class="ot">&lt;-</span> res_list_ctr <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  QALY_cycle_exp_s <span class="ot">&lt;-</span> QALY_cycle_ctr_s <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, n_cycle, S)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  costs_cycle_exp_s <span class="ot">&lt;-</span> costs_cycle_ctr_s <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, n_cycle, S)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  nailive_cycle_exp_s <span class="ot">&lt;-</span> nailive_cycle_ctr_s <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, n_cycle, S)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  npat_cycle_exp_s <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="at">dim=</span><span class="fu">c</span>(n_cycle,<span class="dv">3</span>,S))</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  npat_cycle_ctr_s <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="at">dim=</span><span class="fu">c</span>(n_cycle,<span class="dv">3</span>,S))</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  tm_exp_s <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="at">dim=</span><span class="fu">c</span>(n_cycle,<span class="dv">3</span>,S))</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  tm_ctr_s <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="at">dim=</span><span class="fu">c</span>(n_cycle,<span class="dv">3</span>,S))</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  <span class="co">#assign distributions to each input to generate random value from it at each model iteration</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">#use uniform for probabilities and define departure from mean value</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>S){</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  sd_p <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  tm_exp_init_s <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  tm_exp_init_s[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>,<span class="at">min=</span>tm_exp_init_mu[<span class="dv">1</span>]<span class="sc">-</span><span class="fl">0.05</span>,<span class="at">max=</span>tm_exp_init_mu[<span class="dv">1</span>]<span class="sc">+</span><span class="fl">0.05</span>)</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  tm_exp_init_s[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>,<span class="at">min=</span>tm_exp_init_mu[<span class="dv">2</span>]<span class="sc">-</span><span class="fl">0.05</span>,<span class="at">max=</span>tm_exp_init_mu[<span class="dv">2</span>]<span class="sc">+</span><span class="fl">0.05</span>)</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  tm_exp_init_s[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> tm_exp_init_s[<span class="dv">1</span>] <span class="sc">-</span> tm_exp_init_s[<span class="dv">2</span>] <span class="co">#must ensure sum of prob=1</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>  tm_ctr_init_s <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>  tm_ctr_init_s[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>,<span class="at">min=</span>tm_ctr_init_mu[<span class="dv">1</span>]<span class="sc">-</span><span class="fl">0.05</span>,<span class="at">max=</span>tm_ctr_init_mu[<span class="dv">1</span>]<span class="sc">+</span><span class="fl">0.05</span>)</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  tm_ctr_init_s[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>,<span class="at">min=</span>tm_ctr_init_mu[<span class="dv">2</span>]<span class="sc">-</span><span class="fl">0.05</span>,<span class="at">max=</span>tm_ctr_init_mu[<span class="dv">2</span>]<span class="sc">+</span><span class="fl">0.05</span>)</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>  tm_ctr_init_s[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> tm_ctr_init_s[<span class="dv">1</span>] <span class="sc">-</span> tm_ctr_init_s[<span class="dv">2</span>] <span class="co">#must ensure sum of prob=1</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>  <span class="co">#same for transition matrices but must keep prob of moving out/in of death state =0/1</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>  tm_exp_update_s <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>  tm_exp_update_s <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fu">runif</span>(<span class="dv">1</span>,<span class="at">min=</span>tm_exp_update_mu[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">-</span><span class="fl">0.05</span>,<span class="at">max=</span>tm_exp_update_mu[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">+</span><span class="fl">0.05</span>),<span class="fu">runif</span>(<span class="dv">1</span>,<span class="at">min=</span>tm_exp_update_mu[<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">-</span><span class="fl">0.05</span>,<span class="at">max=</span>tm_exp_update_mu[<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">+</span><span class="fl">0.05</span>),<span class="dv">0</span>,<span class="fu">runif</span>(<span class="dv">1</span>,<span class="at">min=</span>tm_exp_update_mu[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">-</span><span class="fl">0.05</span>,<span class="at">max=</span>tm_exp_update_mu[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">+</span><span class="fl">0.05</span>),<span class="fu">runif</span>(<span class="dv">1</span>,<span class="at">min=</span>tm_exp_update_mu[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">-</span><span class="fl">0.05</span>,<span class="at">max=</span>tm_exp_update_mu[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">+</span><span class="fl">0.05</span>),<span class="dv">0</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="dv">1</span>),<span class="dv">3</span>,<span class="dv">3</span>) </span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>  tm_exp_update_s[<span class="dv">1</span>,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (tm_exp_update_s[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">+</span>tm_exp_update_s[<span class="dv">1</span>,<span class="dv">2</span>]) <span class="co">#ensure sum of probs=1</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>  tm_exp_update_s[<span class="dv">2</span>,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (tm_exp_update_s[<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">+</span>tm_exp_update_s[<span class="dv">2</span>,<span class="dv">2</span>]) <span class="co">#ensure sum of probs=1</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>  tm_ctr_update_s <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>  tm_ctr_update_s <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fu">runif</span>(<span class="dv">1</span>,<span class="at">min=</span>tm_ctr_update_mu[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">-</span><span class="fl">0.05</span>,<span class="at">max=</span>tm_ctr_update_mu[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">+</span><span class="fl">0.05</span>),<span class="fu">runif</span>(<span class="dv">1</span>,<span class="at">min=</span>tm_ctr_update_mu[<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">-</span><span class="fl">0.05</span>,<span class="at">max=</span>tm_ctr_update_mu[<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">+</span><span class="fl">0.05</span>),<span class="dv">0</span>,<span class="fu">runif</span>(<span class="dv">1</span>,<span class="at">min=</span>tm_ctr_update_mu[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">-</span><span class="fl">0.05</span>,<span class="at">max=</span>tm_ctr_update_mu[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">+</span><span class="fl">0.05</span>),<span class="fu">runif</span>(<span class="dv">1</span>,<span class="at">min=</span>tm_ctr_update_mu[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">-</span><span class="fl">0.05</span>,<span class="at">max=</span>tm_ctr_update_mu[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">+</span><span class="fl">0.05</span>),<span class="dv">0</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="dv">1</span>),<span class="dv">3</span>,<span class="dv">3</span>) </span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>  tm_ctr_update_s[<span class="dv">1</span>,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (tm_ctr_update_s[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">+</span>tm_ctr_update_s[<span class="dv">1</span>,<span class="dv">2</span>]) <span class="co">#ensure sum of probs=1</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>  tm_ctr_update_s[<span class="dv">2</span>,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (tm_ctr_update_s[<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">+</span>tm_ctr_update_s[<span class="dv">2</span>,<span class="dv">2</span>]) <span class="co">#ensure sum of probs=1</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>  <span class="co">#use Gamma to generate costs and assume std value</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>  c_sd <span class="ot">&lt;-</span> <span class="dv">150</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>  c_exp_s <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="at">shape=</span>c_exp_mu<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>c_sd<span class="sc">^</span><span class="dv">2</span>,<span class="at">scale=</span>c_sd<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>c_exp_mu)</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>  c_ctr_s <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="at">shape=</span>c_ctr_mu<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>c_sd<span class="sc">^</span><span class="dv">2</span>,<span class="at">scale=</span>c_sd<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>c_ctr_mu)</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>  <span class="co">#use Beta to generate utilities and assume std value</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>  u_sd <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>  u_well_s <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, <span class="at">shape1 =</span> (u_well_mu<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>u_well_mu)<span class="sc">/</span>u_sd<span class="sc">^</span><span class="dv">2-1</span>)<span class="sc">*</span>u_well_mu, <span class="at">shape2 =</span> (u_well_mu<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>u_well_mu)<span class="sc">/</span>u_sd<span class="sc">^</span><span class="dv">2-1</span>)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>u_well_mu))</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>  u_sick_s <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, <span class="at">shape1 =</span> (u_sick_mu<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>u_sick_mu)<span class="sc">/</span>u_sd<span class="sc">^</span><span class="dv">2-1</span>)<span class="sc">*</span>u_sick_mu, <span class="at">shape2 =</span> (u_sick_mu<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>u_sick_mu)<span class="sc">/</span>u_sd<span class="sc">^</span><span class="dv">2-1</span>)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>u_sick_mu))</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>  u_dead_s <span class="ot">&lt;-</span> u_dead_mu <span class="co">#keep utility of dead state=0</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>  <span class="co">#set up matrices to contain results from all TP over each cycle by group</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>  tm_exp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_cycle<span class="sc">+</span><span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(tm_exp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Well"</span>,<span class="st">"Sick"</span>,<span class="st">"Dead"</span>)</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>  tm_ctr <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_cycle<span class="sc">+</span><span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(tm_ctr) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Well"</span>,<span class="st">"Sick"</span>,<span class="st">"Dead"</span>)</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>  <span class="co">#assign first row to be initial TP</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>  tm_exp[<span class="dv">1</span>,] <span class="ot">&lt;-</span> tm_exp_init_s</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>  tm_ctr[<span class="dv">1</span>,] <span class="ot">&lt;-</span> tm_ctr_init_s</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>  <span class="co">#loop through cycles and update TM at each cycle</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">c</span>(n_cycle<span class="sc">+</span><span class="dv">1</span>)){</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>    tm_exp[i,] <span class="ot">&lt;-</span> tm_exp[i<span class="dv">-1</span>,]<span class="sc">%*%</span>tm_exp_update</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>    tm_ctr[i,] <span class="ot">&lt;-</span> tm_ctr[i<span class="dv">-1</span>,]<span class="sc">%*%</span>tm_ctr_update</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>  <span class="co">#remove intial TP from matrices</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>  tm_exp <span class="ot">&lt;-</span> tm_exp[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>  tm_ctr <span class="ot">&lt;-</span> tm_ctr[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>  <span class="co">#using obtained TM to compute number of patients in each health state at each cycle</span></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>  npat_cycle_exp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_cycle<span class="sc">+</span><span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(npat_cycle_exp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Well"</span>,<span class="st">"Sick"</span>,<span class="st">"Dead"</span>)</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>  npat_cycle_ctr <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_cycle<span class="sc">+</span><span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(npat_cycle_ctr) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Well"</span>,<span class="st">"Sick"</span>,<span class="st">"Dead"</span>)</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>  npat_cycle_exp <span class="ot">&lt;-</span> tm_exp<span class="sc">*</span>n_pat</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>  npat_cycle_ctr <span class="ot">&lt;-</span> tm_ctr<span class="sc">*</span>n_pat</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>  <span class="co">#and number still alive</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>  nailive_cycle_exp <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">rowSums</span>(npat_cycle_exp[,<span class="sc">-</span><span class="dv">3</span>]))</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(nailive_cycle_exp) <span class="ot">&lt;-</span> <span class="st">"nalive"</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>  nailive_cycle_ctr <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">rowSums</span>(npat_cycle_ctr[,<span class="sc">-</span><span class="dv">3</span>]))</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(nailive_cycle_ctr) <span class="ot">&lt;-</span> <span class="st">"nalive"</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>  <span class="co">#use obtained number of patients at each cycle to get the same for costs and QALYs</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>  costs_cycle_exp <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">rowSums</span>(<span class="fu">as.matrix</span>(tm_exp<span class="sc">*</span>c_exp_s)[,<span class="sc">-</span><span class="dv">3</span>]))</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(costs_cycle_exp) <span class="ot">&lt;-</span> <span class="st">"costs"</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>  costs_cycle_ctr <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">rowSums</span>(<span class="fu">as.matrix</span>(tm_ctr<span class="sc">*</span>c_ctr_s)[,<span class="sc">-</span><span class="dv">3</span>]))</span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(costs_cycle_ctr) <span class="ot">&lt;-</span> <span class="st">"costs"</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>  QALY_cycle_exp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_cycle<span class="sc">+</span><span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(QALY_cycle_exp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Well"</span>,<span class="st">"Sick"</span>,<span class="st">"Dead"</span>)</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>  QALY_cycle_ctr <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_cycle<span class="sc">+</span><span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(QALY_cycle_ctr) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Well"</span>,<span class="st">"Sick"</span>,<span class="st">"Dead"</span>)</span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>  u_well_v <span class="ot">&lt;-</span> <span class="fu">rep</span>(u_well_s,n_cycle)</span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>  u_sick_v <span class="ot">&lt;-</span> <span class="fu">rep</span>(u_sick_s,n_cycle)</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>  u_dead_v <span class="ot">&lt;-</span> <span class="fu">rep</span>(u_dead_s,n_cycle)</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>  u_M <span class="ot">&lt;-</span> <span class="fu">cbind</span>(u_well_v,u_sick_v,u_dead_v)</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>  QALY_cycle_exp <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">rowSums</span>(<span class="fu">as.matrix</span>(tm_exp<span class="sc">*</span>u_M)[,<span class="sc">-</span><span class="dv">3</span>]))</span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(QALY_cycle_exp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"QALYs"</span>)</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>  QALY_cycle_ctr <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">rowSums</span>(<span class="fu">as.matrix</span>(tm_ctr<span class="sc">*</span>u_M)[,<span class="sc">-</span><span class="dv">3</span>]))</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(QALY_cycle_ctr) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"QALYs"</span>)</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>  <span class="co">#save results from each iteration for each output that we want to store</span></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>  tm_exp_s[,,s] <span class="ot">&lt;-</span> tm_exp</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>  tm_exp_s[,,s] <span class="ot">&lt;-</span> tm_ctr</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>  npat_cycle_exp_s[,,s] <span class="ot">&lt;-</span> npat_cycle_exp</span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>  npat_cycle_ctr_s[,,s] <span class="ot">&lt;-</span> npat_cycle_ctr</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>  nailive_cycle_exp_s[,s] <span class="ot">&lt;-</span> nailive_cycle_exp</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>  nailive_cycle_ctr_s[,s] <span class="ot">&lt;-</span> nailive_cycle_ctr</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>  costs_cycle_exp_s[,s] <span class="ot">&lt;-</span> costs_cycle_exp</span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>  costs_cycle_ctr_s[,s] <span class="ot">&lt;-</span> costs_cycle_ctr</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>  QALY_cycle_exp_s[,s] <span class="ot">&lt;-</span> QALY_cycle_exp</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>  QALY_cycle_ctr_s[,s] <span class="ot">&lt;-</span> QALY_cycle_ctr</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>  <span class="co">#save output</span></span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>  res_list_exp[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> tm_exp_s</span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>  res_list_exp[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> npat_cycle_exp_s</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>  res_list_exp[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> nailive_cycle_exp_s</span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>  res_list_exp[[<span class="dv">4</span>]] <span class="ot">&lt;-</span> costs_cycle_exp_s</span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>  res_list_exp[[<span class="dv">5</span>]] <span class="ot">&lt;-</span> QALY_cycle_exp_s</span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>  res_list_ctr[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> tm_ctr_s</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>  res_list_ctr[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> npat_cycle_ctr_s</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>  res_list_ctr[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> nailive_cycle_ctr_s</span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>  res_list_ctr[[<span class="dv">4</span>]] <span class="ot">&lt;-</span> costs_cycle_ctr_s</span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>  res_list_ctr[[<span class="dv">5</span>]] <span class="ot">&lt;-</span> QALY_cycle_ctr_s</span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(res_list_exp)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"TM"</span>,<span class="st">"npatients"</span>,<span class="st">"nalive"</span>,<span class="st">"costs"</span>,<span class="st">"QALYs"</span>)</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(res_list_ctr)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"TM"</span>,<span class="st">"npatients"</span>,<span class="st">"nalive"</span>,<span class="st">"costs"</span>,<span class="st">"QALYs"</span>)</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>  res_list[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> res_list_exp</span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>  res_list[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> res_list_ctr</span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(res_list)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Experimental"</span>,<span class="st">"Control"</span>)</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(res_list)</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a><span class="co">#end of cycle 1 TP</span></span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>trans_mat_cycle1_exp <span class="ot">&lt;-</span> tm_exp_init<span class="sc">%*%</span>tm_exp_update</span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>trans_mat_cycle1_ctr <span class="ot">&lt;-</span> tm_ctr_init<span class="sc">%*%</span>tm_ctr_update</span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a><span class="co">#lists to store TP results by cycle</span></span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>trans_mat_cycles_exp <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>trans_mat_cycles_ctr <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a><span class="co">#run the function and get the output</span></span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2345</span>) <span class="co">#set rng seed for replicability</span></span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a>mm_res_psa <span class="ot">&lt;-</span> <span class="fu">mm_sim_psa</span>(<span class="at">tm_exp_init_mu =</span> tm_exp_init_mu, <span class="at">tm_ctr_init_mu =</span> tm_ctr_init_mu, <span class="at">tm_exp_update_mu =</span> tm_exp_update_mu, <span class="at">tm_ctr_update_mu =</span> tm_ctr_update_mu, <span class="at">u_well_mu =</span> u_well_mu, <span class="at">u_sick_mu =</span> u_sick_mu, <span class="at">u_dead_mu =</span> u_dead_mu, <span class="at">c_exp_mu =</span> c_exp_mu, <span class="at">c_ctr_mu =</span> c_ctr_mu, <span class="at">n_cycle =</span> n_cycle, <span class="at">n_pat =</span> n_pat, <span class="at">S=</span>S)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now inspect the results of the model based on a total of <span class="math inline">\(S=500\)</span> iterations, i.e.&nbsp;a random value for each model input was generated 500 times from their assumed probability distribution and used in the model to generate the output as in the base-case analysis. This implies that for each output obtained in the base-case, we now obtain a set of values or distribution of values that we can take a look at. By doing so, we are effectively quantifying the degree of uncertainty surrounding each model input. For example, we can inspect the distribution of the expected costs and QALY differences in between the Experimental and Control intervention through histograms, shown in <a href="#fig-hist-ec-psa" class="quarto-xref">Figure&nbsp;1</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-hist-ec-psa" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-pos="h">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-hist-ec-psa-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-hist-ec-psa-1.png" class="img-fluid figure-img" style="width:100.0%" data-fig-pos="h">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-hist-ec-psa-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Histograms of the distribution of expected costs and QALY differences between Experimental and Control group based on the results from the probabilistic sensitivity analysis.
</figcaption>
</figure>
</div>
</div>
</div>
<p>We can now replicate the approach used for the base-case model by summarising the results in terms of common health economic measures, such as ICER and NB, assuming a willingness to pay parameter of 2^{4} for decision-making purposes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create data frame</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>mu_res <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(mu_c_exp_post,mu_c_ctr_post,mu_e_exp_post,mu_e_ctr_post)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#summary statistics for costs and QALYs by arm across simulations</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mu_res) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> mu_c_exp_post  mu_c_ctr_post    mu_e_exp_post    mu_e_ctr_post   
 Min.   : 965   Min.   : 69.23   Min.   :0.6043   Min.   :0.1755  
 1st Qu.:1567   1st Qu.:178.73   1st Qu.:0.8448   1st Qu.:0.2508  
 Median :1752   Median :231.93   Median :0.9471   Median :0.2876  
 Mean   :1791   Mean   :241.78   Mean   :0.9514   Mean   :0.2891  
 3rd Qu.:1990   3rd Qu.:290.33   3rd Qu.:1.0494   3rd Qu.:0.3193  
 Max.   :2557   Max.   :561.54   Max.   :1.4197   Max.   :0.4490  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ICER <span class="ot">&lt;-</span> mu_c_diff_post<span class="sc">/</span>mu_e_diff_post</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>NB <span class="ot">&lt;-</span> K<span class="sc">*</span>mu_e_diff_post <span class="sc">-</span> mu_c_diff_post</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#summary statistics for ICER/NB across simulations</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ICER) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   1099    1969    2350    2397    2751    4276 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(NB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   6199    9984   11609   11697   13231   18915 </code></pre>
</div>
</div>
<p>Finally, another typical source of uncertainty in these analyses is around the value of the acceptance threshold itself, as in many cases governments’ decisions are always characterised by some degree of uncertainty around what value for <span class="math inline">\(K\)</span> to use. Often this is quantified by computing the above probability of cost-effectiveness for a range of values of <span class="math inline">\(K\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#range of values to consider for K</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>k_value <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1000</span>, <span class="at">to =</span> <span class="dv">20000</span>, <span class="at">by =</span> <span class="dv">50</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>n_kval <span class="ot">&lt;-</span> <span class="fu">length</span>(k_value)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>NB_k <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="at">nrow =</span> S, <span class="at">ncol =</span> n_kval)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>p_CE_nb_k <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_kval)  </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">#compute prob CE based on NB at each value of K</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_kval){</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>S){</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  NB_k[s,k] <span class="ot">&lt;-</span> k_value[k]<span class="sc">*</span>mu_e_diff_post[s] <span class="sc">-</span> mu_c_diff_post[s]</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  p_CE_nb_k[k] <span class="ot">&lt;-</span> <span class="fu">sum</span>(NB_k[,k]<span class="sc">&gt;</span><span class="dv">0</span>)<span class="sc">/</span>S</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and then plot the results in <a href="#fig-pce-mm" class="quarto-xref">Figure&nbsp;2</a> to show what is known as the cost-effectiveness acceptability curve (CEAC), showing how the probability of cost-effectiveness changes as the value of <span class="math inline">\(K\)</span> is varied.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pce-mm" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-pos="h">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pce-mm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-pce-mm-1.png" class="img-fluid figure-img" style="width:80.0%" data-fig-pos="h">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pce-mm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: CEAC based on PSA results from Markov Model
</figcaption>
</figure>
</div>
</div>
</div>
<p>I hope you liked today’s topic as I sure did. Till next time!</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-khan2015design" class="csl-entry" role="listitem">
Khan, Iftekhar. 2015. <em>Design &amp; Analysis of Clinical Trials for Economic Evaluation &amp; Reimbursement: An Applied Approach Using SAS &amp; STATA</em>. CRC Press.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2024, Andrea Gabrio</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>